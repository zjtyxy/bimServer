/* 2019-12-13 19:58:45 | 版权所有 国信同科 http://marsgis.cn */
function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var GaodeRouteType={Walking:1,Bicycling:2,Driving:3},GaodeRoute=function(){"use strict";function t(e){_classCallCheck(this,t),this._keys=e.key||["027187040fa924e56048468aaa77b62c","2e6ca4aeb6867fb637a5bee8333e5d3a"],this._key_index=0}return _createClass(t,[{key:"_formatRouteData",value:function(e,t,r){var n,s,i=[];if(e&&(n=mars3d.pointconvert.gcj2wgs(e.split(","))),t&&(s=mars3d.pointconvert.gcj2wgs(t.split(","))),r&&0<r.length)for(var o=0;o<r.length;o++){var a=[];a.push(n);for(var u=r[o],c=u.steps,p=[],l=[],f=0;f<c.length;f++){for(var y={instruction:c[f].instruction,distance:c[f].distance,duration:c[f].duration,points:[],route:c[f].road},g=c[f].polyline.split(";"),h=0;h<g.length;h++){var d=g[h],v=mars3d.pointconvert.gcj2wgs(d.split(","));a.push(v),y.points.push(v)}l.push(y.route),p.push(y)}a.push(s),i.push({allDistance:u.distance,allDuration:u.duration,steps:p,points:a,road:l})}return{origin:n,destination:s,paths:i}}},{key:"query",value:function(e){switch(e.type){default:case GaodeRouteType.Walking:this.queryWalking(e);break;case GaodeRouteType.Bicycling:this.queryBicycling(e);break;case GaodeRouteType.Driving:this.queryDriving(e)}}},{key:"queryArr",value:function(r){var e=this,n=-1,s={};for(var t in r)"points"!=t&&"success"!=t&&"error"!=t&&(s[t]=r[t]);var i=r.points,o=[];!function t(){n++,s.points=i[n],s.success=function(e){e&&e.paths&&0<e.paths.length?o.push(e.paths[0]):o.push(null),n>=i.length-1?r.success&&r.success(o):t()},s.error=s.success,e.query(s)}()}},{key:"computeMindistanceLine",value:function(e){for(var t=Number.MAX_VALUE,r=null,n=-1,s=0;s<e.length;s++){var i=e[s];i&&i.allDistance<=t&&(n=s,t=(r=i).allDistance)}return{lineData:r,index:n}}},{key:"queryWalking",value:function(n){var s={key:this.key,output:"json"},e=mars3d.pointconvert.wgs2gcj(n.points[0]),t=mars3d.pointconvert.wgs2gcj(n.points[n.points.length-1]);s.origin=e[0]+","+e[1],s.destination=t[0]+","+t[1];var i=this;$.ajax({url:"http://restapi.amap.com/v3/direction/walking",type:"GET",dataType:"json",timeout:"5000",contentType:"application/json;utf-8",data:s,success:function(e){if("10000"===e.infocode)if(e.route&&e.route.paths){var t=i._formatRouteData(s.origin,s.destination,e.route.paths);n.success&&n.success(t)}else{r="未查询到相关结果！";n.error&&n.error(r)}else{var r="路径规划 请求失败("+e.infocode+")："+e.info;n.error&&n.error(r)}},error:function(e){var t="请求出错("+e.status+")："+e.statusText;n.error&&n.error(t)}})}},{key:"queryBicycling",value:function(n){var s={key:this.key,output:"json"},e=mars3d.pointconvert.wgs2gcj(n.points[0]),t=mars3d.pointconvert.wgs2gcj(n.points[n.points.length-1]);s.origin=e[0]+","+e[1],s.destination=t[0]+","+t[1];var i=this;$.ajax({url:"https://restapi.amap.com/v4/direction/bicycling",type:"GET",dataType:"json",timeout:"5000",contentType:"application/json;utf-8",data:s,success:function(e){if("10000"===e.infocode)if(e.route&&e.route.paths){var t=i._formatRouteData(s.origin,s.destination,e.route.paths);n.success&&n.success(t)}else{r="未查询到相关结果！";n.error&&n.error(r)}else{var r="路径规划 请求失败("+e.infocode+")："+e.info;n.error&&n.error(r)}},error:function(e){var t="请求出错("+e.status+")："+e.statusText;n.error&&n.error(t)}})}},{key:"queryDriving",value:function(n){var s={key:this.key,output:"json"},e=mars3d.pointconvert.wgs2gcj(n.points[0]),t=mars3d.pointconvert.wgs2gcj(n.points[n.points.length-1]);s.origin=e[0]+","+e[1],s.destination=t[0]+","+t[1],s.extensions=n.extensions||"base",s.strategy=n.strategy||0;var i=this;$.ajax({url:"https://restapi.amap.com/v3/direction/driving",type:"GET",dataType:"json",timeout:"5000",contentType:"application/json;utf-8",data:s,success:function(e){if("10000"===e.infocode)if(e.route&&e.route.paths&&0!=e.route.paths.length){var t=i._formatRouteData(s.origin,s.destination,e.route.paths);n.success&&n.success(t)}else{r="未查询到相关结果！";n.error&&n.error(r)}else{var r="路径规划 请求失败("+e.infocode+")："+e.info;n.error&&n.error(r)}},error:function(e){var t="请求出错("+e.status+")："+e.statusText;n.error&&n.error(t)}})}},{key:"keys",get:function(){return this._keys},set:function(e){this._keys=e}},{key:"key",get:function(){var e=this._key_index++%this._keys.length;return this._keys[e]}}]),t}();